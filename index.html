<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mundo Decimal: Herramientas Integradas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* === ESTILOS GLOBALES Y DE NAVEGACI√ìN === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
        }
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --accent: #ff6b6b;
            --light: #f8f9ff;
            --dark: #2d2d44;
            --gray: #e0e0ff;
            --green: #7cbe29;
            --blue: #75AADB;
            --marker1: #ff6b6b;
            --marker2: #48bb78;
            --marker3: #f6ad55;
        }
        body {
            background-color: #f0f2f5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .main-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 30px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
        }
        .main-header h1 {
            font-size: 28px;
            font-weight: 700;
        }
        .main-nav {
            background: white;
            display: flex;
            justify-content: center;
            padding: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            z-index: 50;
            position: sticky;
            top: 0;
            flex-wrap: wrap;
        }
        .nav-btn {
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            background: transparent;
            border: none;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            margin: 5px;
        }
        .nav-btn:hover {
            color: var(--secondary);
        }
        .nav-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        main {
            flex: 1;
            padding: 20px;
            overflow: auto;
        }
        .app-view {
            display: none; /* Se ocultan todas por defecto */
        }
        .app-view.active {
            display: block; /* Se muestra la activa */
        }
        .compare-btn {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            font-size: 15px;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }
        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.5);
        }
        .compare-btn i {
            margin-right: 5px;
        }
        /* === ESTILOS PARA APP 1: RECTA NUM√âRICA (RECTA NUMERICA.HTML) === */
        /* Adaptado: el 'body' original es ahora el div #app-recta */
        #app-recta {
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Ajustado para que no est√© siempre centrado verticalmente */
            padding: 20px 0;
            min-height: 80vh;
        }
        #app-recta .card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 900px;
            overflow: hidden;
            position: relative;
        }
        #app-recta .header {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            padding: 30px 25px;
            text-align: center;
        }
        #app-recta .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        #app-recta .header p {
            opacity: 0.9;
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }
        #app-recta .input-section {
            padding: 30px;
            text-align: center;
            background: var(--light);
        }
        #app-recta .input-group {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        #app-recta input[type="text"] {
            padding: 14px 20px;
            font-size: 18px;
            border: 2px solid #ddd;
            border-radius: 50px;
            width: 220px;
            text-align: center;
            transition: all 0.3s ease;
            outline: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        #app-recta input[type="text"]:focus {
            border-color: var(--secondary);
            box-shadow: 0 4px 15px rgba(37, 117, 252, 0.3);
        }
        #app-recta button {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 32px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 15px rgba(37, 117, 252, 0.4);
        }
        #app-recta button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 117, 252, 0.6);
        }
        #app-recta .error {
            color: #e74c3c;
            margin-top: 15px;
            font-weight: 600;
            min-height: 22px;
            font-size: 15px;
        }
        #app-recta .number-line-container {
            padding: 25px;
            border-bottom: 1px solid #f0f0f0;
        }
        #app-recta .number-line-container:last-child {
            border-bottom: none;
        }
        #app-recta .number-line-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
        }
        #app-recta .number-line {
            position: relative;
            height: 90px;
            margin-top: 15px;
        }
        #app-recta .line {
            position: absolute;
            top: 40px;
            left: 5%;
            right: 5%;
            height: 4px;
            background: linear-gradient(to right, #ccc, #999);
            border-radius: 2px;
        }
        #app-recta .tick {
            position: absolute;
            top: 38px;
            width: 2px;
            height: 12px;
            background: #555;
        }
        #app-recta .tick-label {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 13px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            width: max-content;
        }
        #app-recta .marker {
            position: absolute;
            top: 25px;
            width: 4px;
            height: 30px;
            background: var(--accent);
            border-radius: 2px;
            transform: translateX(-50%);
            box-shadow: 0 0 8px rgba(255, 107, 107, 0.7);
        }
        #app-recta .marker-label {
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 700;
            font-size: 15px;
            white-space: nowrap;
            box-shadow: 0 3px 8px rgba(255, 107, 107, 0.4);
        }
        #app-recta .hidden {
            display: none;
        }
        #app-recta .example {
            margin-top: 12px;
            font-size: 14px;
            color: #666;
        }
        
        /* === ESTILOS PARA LA HERRAMIENTA DE COMPARACI√ìN === */
        #recta-comparison-container {
            padding: 20px;
            background: #f8f9ff;
            border-radius: 20px;
            margin: 20px 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
        }
        #recta-comparison-container .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        #recta-comparison-container .header h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        #recta-comparison-container .input-group-compare {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        #recta-comparison-container input[type="text"] {
            padding: 12px;
            font-size: 16px;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            width: 160px;
            text-align: center;
            transition: all 0.3s;
            font-weight: 600;
        }
        #recta-comparison-container input#comp-num1 { border-color: var(--marker1); }
        #recta-comparison-container input#comp-num2 { border-color: var(--marker2); }
        #recta-comparison-container input#comp-num3 { border-color: var(--marker3); }
        #recta-comparison-container input[type="text"]:focus {
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.4);
            transform: translateY(-1px);
        }
        #recta-comparison-container button#comp-compareBtn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 12px 25px;
            font-size: 16px;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }
        #recta-comparison-container .comparison-line {
            position: relative;
            height: 70px;
            background: white;
            border-radius: 12px;
            margin: 25px 0;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        #recta-comparison-container .line-comparison {
            position: absolute;
            top: 35px;
            left: 5%;
            right: 5%;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 50%, #667eea 100%);
            border-radius: 2px;
        }
        #recta-comparison-container .tick-comparison {
            position: absolute;
            top: 33px;
            width: 2px;
            height: 10px;
            background: #667eea;
        }
        #recta-comparison-container .tick-label-comparison {
            position: absolute;
            top: 45px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #4a5568;
        }
        #recta-comparison-container .marker-comparison {
            position: absolute;
            top: 20px;
            width: 5px;
            height: 25px;
            border-radius: 2px;
            transform: translateX(-50%);
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
        }
        #recta-comparison-container .marker-1 { background: var(--marker1); }
        #recta-comparison-container .marker-2 { background: var(--marker2); }
        #recta-comparison-container .marker-3 { background: var(--marker3); }
        #recta-comparison-container .marker-label-comparison {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        #recta-comparison-container .label-1 { 
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            color: white;
        }
        #recta-comparison-container .label-2 { 
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        #recta-comparison-container .label-3 { 
            background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);
            color: white;
        }
        #recta-comparison-container #comp-comparison-result {
            padding: 15px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            text-align: center;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--dark);
            border-radius: 12px;
            margin-top: 15px;
            border: 1px solid rgba(102, 126, 234, 0.3);
        }
        @media (max-width: 650px) {
            #app-recta .input-group {
                flex-direction: column;
                align-items: center;
            }
            #app-recta input[type="text"], #app-recta button {
                width: 100%;
                max-width: 300px;
            }
            #app-recta .tick-label {
                font-size: 11px;
            }
            #recta-comparison-container .input-group-compare {
                flex-direction: column;
                align-items: center;
            }
            #recta-comparison-container input[type="text"] {
                width: 100%;
                max-width: 250px;
            }
        }
        /* === ESTILOS PARA APP 2: CONCEPTOS (CUADROS.HTML) === */
        /* Adaptado: el 'body' original es ahora el div #app-conceptos */
        #app-conceptos {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--blue);
            min-height: 80vh;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
        }
        #app-conceptos h1 {
            color: white;
            font-size: 36px;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        #app-conceptos .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 18px;
            text-align: center;
            margin-bottom: 40px;
        }
        #app-conceptos .container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            max-width: 1400px;
        }
        #app-conceptos .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            text-align: center;
            min-width: 300px;
        }
        #app-conceptos .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        #app-conceptos .card-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        #app-conceptos .square-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        #app-conceptos .square {
            width: 100%;
            height: 100%;
            background: var(--green);
            border: 3px solid #000;
        }
        #app-conceptos .grid {
            display: grid;
            width: 100%;
            height: 100%;
            background-color: var(--green);
            border: 3px solid #000;
        }
        #app-conceptos .grid-10 { grid-template-columns: repeat(10, 1fr); }
        #app-conceptos .grid-100 { grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); }
        #app-conceptos .grid-1000 { grid-template-columns: repeat(32, 1fr); grid-template-rows: repeat(32, 1fr); }
        #app-conceptos .grid-cell { border: 0.5px solid #333; background: var(--green); }
        #app-conceptos .grid-1000 .grid-cell { border: 0.2px solid #555; }
        #app-conceptos .formula {
            font-size: 16px;
            color: #555;
            margin: 10px 0;
            line-height: 1.6;
        }
        #app-conceptos .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 3px;
        }
        #app-conceptos .fraction-top {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        #app-conceptos .fraction-bottom {
            display: block;
            padding-top: 2px;
        }
        #app-conceptos .highlight {
            color: #667eea;
            font-weight: 700;
        }
        /* Modal de pantalla completa (App 2) */
        #app-conceptos .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            animation: app-conceptos-fadeIn 0.3s ease;
        }
        #app-conceptos .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        @keyframes app-conceptos-fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #app-conceptos .modal-content {
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: app-conceptos-zoomIn 0.3s ease;
        }
        @keyframes app-conceptos-zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        #app-conceptos .modal-title {
            color: white;
            font-size: 48px;
            margin-bottom: 30px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }
        #app-conceptos .modal-square {
            width: 70vmin;
            height: 70vmin;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            margin-bottom: 30px;
            flex-shrink: 0;
        }
        #app-conceptos .modal-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 25px 40px;
            border-radius: 15px;
            color: white;
            font-size: 22px;
            text-align: center;
            max-width: 800px;
            line-height: 1.8;
        }
        #app-conceptos .close-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        #app-conceptos .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        @media (max-width: 768px) {
            #app-conceptos .container { gap: 20px; }
            #app-conceptos .card { min-width: 250px; padding: 20px; }
            #app-conceptos .square-container { width: 150px; height: 150px; }
            #app-conceptos h1 { font-size: 28px; }
            #app-conceptos .modal-title { font-size: 32px; }
            #app-conceptos .modal-info { font-size: 18px; padding: 20px; }
        }
        /* === ESTILOS PARA APP 3: REPRESENTACI√ìN DIN√ÅMICA (REPRESENTACION CUADROS.HTML) === */
        /* Adaptado: el 'body' original es ahora el div #app-representacion */
        #app-representacion {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--blue);
            min-height: 80vh;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            border-radius: 20px;
        }
        #app-representacion h1 {
            color: white;
            font-size: 36px;
            text-align: center;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        #app-representacion .input-section {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }
        #app-representacion .input-section input {
            padding: 12px;
            font-size: 18px;
            border: 2px solid #667eea;
            border-radius: 8px;
            width: 200px;
            text-align: center;
            margin: 5px 10px;
        }
        #app-representacion .input-section button {
            padding: 12px 24px;
            font-size: 18px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
            margin: 5px;
        }
        #app-representacion .input-section button:hover { background: #5a6fd8; }
        #app-representacion .input-section button.clear-btn { background: #e2e8f0; color: #4a5568; }
        #app-representacion .input-section button.clear-btn:hover { background: #cbd5e0; }
        #app-representacion .error {
            color: #e74c3c;
            margin-top: 10px;
            font-size: 16px;
        }
        #app-representacion .container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            max-width: 1400px;
        }
        #app-representacion .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            text-align: center;
            min-width: 220px;
            max-width: 280px;
        }
        #app-representacion .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
        }
        #app-representacion .card-title {
            font-size: 20px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }
        #app-representacion .square-container {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }
        #app-representacion .square {
            width: 100%;
            height: 100%;
            background: #ddd;
            border: 3px solid #000;
        }
        #app-representacion .square.empty-unit { background: #fff; }
        #app-representacion .unit-square {
            background: var(--green);
            border: 3px solid #000;
            flex-shrink: 0;
        }
        #app-representacion .filled { background: var(--green) !important; }
        #app-representacion .grid {
            display: grid;
            width: 100%;
            height: 100%;
            background-color: #eee;
            border: 3px solid #000;
        }
        #app-representacion .grid-10 { grid-template-columns: repeat(10, 1fr); }
        #app-representacion .grid-100 { grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); }
        #app-representacion .grid-1000 { grid-template-columns: repeat(32, 1fr); grid-template-rows: repeat(32, 1fr); }
        #app-representacion .grid-cell { border: 0.5px solid #000; background: #eee; }
        #app-representacion .grid-1000 .grid-cell { border: 0.2px solid #000; }
        #app-representacion .formula {
            font-size: 14px;
            color: #555;
            margin: 10px 0;
            line-height: 1.5;
        }
        #app-representacion .fraction {
            display: inline-block;
            vertical-align: middle;
            text-align: center;
            margin: 0 3px;
        }
        #app-representacion .fraction-top {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        #app-representacion .fraction-bottom { display: block; padding-top: 2px; }
        #app-representacion .highlight { color: #667eea; font-weight: 700; }
        #app-representacion .units-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            padding: 10px;
        }
        /* Modal de pantalla completa (App 3) */
        #app-representacion .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            z-index: 1000;
            animation: app-rep-fadeIn 0.3s ease;
        }
        #app-representacion .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        @keyframes app-rep-fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #app-representacion .modal-content {
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: app-rep-zoomIn 0.3s ease;
        }
        @keyframes app-rep-zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        #app-representacion .modal-title {
            color: white;
            font-size: 40px;
            margin-bottom: 25px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }
        #app-representacion .modal-square {
            width: 65vmin;
            height: 65vmin;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            margin-bottom: 25px;
            flex-shrink: 0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        #app-representacion .modal-unit {
            width: 120px;
            height: 120px;
            background: var(--green);
            border: 3px solid #000;
        }
        #app-representacion .modal-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 15px;
            color: white;
            font-size: 20px;
            text-align: center;
            max-width: 750px;
            line-height: 1.7;
        }
        #app-representacion .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        #app-representacion .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        @media (max-width: 768px) {
            #app-representacion .container { gap: 15px; }
            #app-representacion .card { min-width: 180px; padding: 18px; }
            #app-representacion .square-container { width: 140px; height: 140px; }
            #app-representacion .unit-square { width: 40px; height: 40px; }
            #app-representacion .modal-unit { width: 80px; height: 80px; }
            #app-representacion h1 { font-size: 26px; }
            #app-representacion .modal-title { font-size: 28px; }
            #app-representacion .modal-info { font-size: 16px; padding: 15px; }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <h1>Mundo Decimal: Herramientas Integradas üî¢</h1>
    </header>
    <nav class="main-nav">
        <button id="nav-btn-recta" class="nav-btn active" onclick="showApp('app-recta')">
            <i class="fas fa-ruler-horizontal"></i> Recta Num√©rica
        </button>
        <button id="nav-btn-rep" class="nav-btn" onclick="showApp('app-representacion')">
            <i class="fas fa-shapes"></i> Representaci√≥n Din√°mica
        </button>
        <button id="nav-btn-con" class="nav-btn" onclick="showApp('app-conceptos')">
            <i class="fas fa-book-open"></i> Conceptos (Unidad, D√©cima...)
        </button>
    </nav>
    <main>
        <div id="app-recta" class="app-view active">
            <div class="card">
                <div class="header">
                    <h1><i class="fas fa-ruler-horizontal"></i> Recta Num√©rica Decimal</h1>
                    <p>Introduce un n√∫mero y observa su ubicaci√≥n en unidades, d√©cimas, cent√©simas y mil√©simas</p>
                </div>
                <div class="input-section">
                    <div class="input-group">
                        <input type="text" id="recta-decimalInput" placeholder="Ej. 1,376 o -2.5" />
                        <button id="recta-locateBtn">
                            <i class="fas fa-map-marker-alt"></i> Ubicar
                        </button>
                    </div>
                    <button id="recta-toggle-comparison" class="compare-btn">
                        <i class="fas fa-balance-scale"></i> Comparar n√∫meros decimales
                    </button>
                    <div class="example">üí° Ejemplos: <code>1.376</code>, <code>-0,5</code>, <code>3,141</code></div>
                    <div id="recta-errorMessage" class="error"></div>
                </div>
                <div class="number-line-container" id="recta-section1">
                    <div class="number-line-title">
                        <i class="fas fa-arrows-alt-h"></i> Paso 1: Unidades
                    </div>
                    <div class="number-line" id="recta-lineUnits">
                        <div class="line"></div>
                    </div>
                </div>
                <div class="number-line-container hidden" id="recta-section2">
                    <div class="number-line-title">
                        <i class="fas fa-level-up-alt"></i> Paso 2: D√©cimas
                    </div>
                    <div class="number-line" id="recta-lineTenths">
                        <div class="line"></div>
                    </div>
                </div>
                <div class="number-line-container hidden" id="recta-section3">
                    <div class="number-line-title">
                        <i class="fas fa-search-plus"></i> Paso 3: Cent√©simas
                    </div>
                    <div class="number-line" id="recta-lineHundredths">
                        <div class="line"></div>
                    </div>
                </div>
                <div class="number-line-container hidden" id="recta-section4">
                    <div class="number-line-title">
                        <i class="fas fa-microscope"></i> Paso 4: Mil√©simas
                    </div>
                    <div class="number-line" id="recta-lineThousandths">
                        <div class="line"></div>
                    </div>
                </div>
                
                <!-- Contenedor para la herramienta de comparaci√≥n -->
                <div id="recta-comparison-container" class="hidden">
                    <div class="header">
                        <h2><i class="fas fa-balance-scale"></i> Comparador Decimal en Recta Num√©rica</h2>
                        <p>Introduce hasta 3 n√∫meros decimales para compararlos</p>
                    </div>
                    
                    <div class="input-section">
                        <div class="input-group-compare">
                            <input type="text" id="comp-num1" placeholder="N√∫mero 1 (Ej. 1.5)">
                            <input type="text" id="comp-num2" placeholder="N√∫mero 2 (Ej. -0.2)">
                            <input type="text" id="comp-num3" placeholder="N√∫mero 3 (Ej. 0.75)">
                        </div>
                        <button id="comp-compareBtn">
                            <i class="fas fa-sort-numeric-down"></i> Comparar
                        </button>
                        <div id="comp-errorMessage" class="error"></div>
                    </div>
                    
                    <div class="number-line-container" id="comp-static-line-container">
                        <div class="number-line-title">Recta Num√©rica de Referencia</div>
                        <div class="comparison-line" id="comp-staticNumberLine">
                            <div class="line-comparison"></div>
                        </div>
                    </div>
                    
                    <div class="number-line-container hidden" id="comp-comparison-section">
                        <div class="number-line-title">Comparaci√≥n Visual</div>
                        <div class="comparison-line" id="comp-mainNumberLine">
                            <div class="line-comparison"></div>
                        </div>
                    </div>
                    
                    <div id="comp-comparison-result" class="hidden"></div>
                </div>
            </div>
        </div>
        <div id="app-conceptos" class="app-view">
            <h1>REPRESENTACI√ìN DE N√öMEROS DECIMALES</h1>
            <p class="subtitle">Haz clic en cada cuadrado para verlo en grande</p>
            <div class="container">
                <div class="card" onclick="con_openModal('unidad')">
                    <h2 class="card-title">1 UNIDAD</h2>
                    <div class="square-container">
                        <div class="square"></div>
                    </div>
                    <div class="formula">
                        <span class="highlight">1 unidad</span> = un todo completo
                    </div>
                </div>
                <div class="card" onclick="con_openModal('decimas')">
                    <h2 class="card-title">D√âCIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-10" id="con-preview-decimas"></div>
                    </div>
                    <div class="formula">
                        1 unidad = <span class="highlight">10 d√©cimas</span><br>
                        1 d√©cima = <span class="fraction"><span class="fraction-top">1</span><span class="fraction-bottom">10</span></span> = 0,1
                    </div>
                </div>
                <div class="card" onclick="con_openModal('centesimas')">
                    <h2 class="card-title">CENT√âSIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-100" id="con-preview-centesimas"></div>
                    </div>
                    <div class="formula">
                        1 unidad = <span class="highlight">100 cent√©simas</span><br>
                        1 cent√©sima = <span class="fraction"><span class="fraction-top">1</span><span class="fraction-bottom">100</span></span> = 0,01
                    </div>
                </div>
                <div class="card" onclick="con_openModal('milesimas')">
                    <h2 class="card-title">MIL√âSIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-1000" id="con-preview-milesimas"></div>
                    </div>
                    <div class="formula">
                        1 unidad = <span class="highlight">1.000 mil√©simas</span><br>
                        1 mil√©sima = <span class="fraction"><span class="fraction-top">1</span><span class="fraction-bottom">1.000</span></span> = 0,001
                    </div>
                </div>
            </div>
            <div class="modal" id="con-modal-unidad">
                <div class="close-btn" onclick="con_closeModal('unidad')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">1 UNIDAD</h2>
                    <div class="modal-square">
                        <div class="square"></div>
                    </div>
                    <div class="modal-info">
                        La <span class="highlight">unidad</span> representa un todo completo.
                    </div>
                </div>
            </div>
            <div class="modal" id="con-modal-decimas">
                <div class="close-btn" onclick="con_closeModal('decimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">D√âCIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-10" id="con-modal-grid-decimas"></div>
                    </div>
                    <div class="modal-info">
                        Cuando dividimos la unidad en <span class="highlight">10 partes iguales</span>,<br>
                        cada parte es una <span class="highlight">d√©cima</span> (1/10 = 0,1)
                    </div>
                </div>
            </div>
            <div class="modal" id="con-modal-centesimas">
                <div class="close-btn" onclick="con_closeModal('centesimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">CENT√âSIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-100" id="con-modal-grid-centesimas"></div>
                    </div>
                    <div class="modal-info">
                        Cuando dividimos la unidad en <span class="highlight">100 partes iguales</span>,<br>
                        cada parte es una <span class="highlight">cent√©sima</span> (1/100 = 0,01)
                    </div>
                </div>
            </div>
            <div class="modal" id="con-modal-milesimas">
                <div class="close-btn" onclick="con_closeModal('milesimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">MIL√âSIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-1000" id="con-modal-grid-milesimas"></div>
                    </div>
                    <div class="modal-info">
                        Cuando dividimos la unidad en <span class="highlight">1.000 partes iguales</span>,<br>
                        cada parte es una <span class="highlight">mil√©sima</span> (1/1000 = 0,001)
                    </div>
                </div>
            </div>
        </div>
        <div id="app-representacion" class="app-view">
            <h1>REPRESENTACI√ìN DE N√öMEROS DECIMALES</h1>
            <div class="input-section">
                <label>
                    Introduce un n√∫mero decimal (ej. 2.875):
                    <input type="number" id="rep-decimalInput" step="0.001" min="0" placeholder="2.875">
                </label>
                <button onclick="rep_renderDecimal()">Representar</button>
                <button onclick="rep_clearRepresentation()" class="clear-btn">Limpiar</button>
                <div id="rep-errorMessage" class="error"></div>
            </div>
            <div class="container" id="rep-representationContainer">
                </div>
            <div class="modal" id="rep-modal-unidad">
                <div class="close-btn" onclick="rep_closeModal('unidad')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">UNIDADES</h2>
                    <div class="modal-square" id="rep-modal-square-unidad"></div>
                    <div class="modal-info" id="rep-modal-info-unidad"></div>
                </div>
            </div>
            <div class="modal" id="rep-modal-decimas">
                <div class="close-btn" onclick="rep_closeModal('decimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">D√âCIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-10" id="rep-modal-grid-decimas"></div>
                    </div>
                    <div class="modal-info">
                        Cada barra = 1 d√©cima (0.1).<br>
                        Total coloreadas: <span id="rep-count-decimas">0</span>
                    </div>
                </div>
            </div>
            <div class="modal" id="rep-modal-centesimas">
                <div class="close-btn" onclick="rep_closeModal('centesimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">CENT√âSIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-100" id="rep-modal-grid-centesimas"></div>
                    </div>
                    <div class="modal-info">
                        Cada cuadrito = 1 cent√©sima (0.01).<br>
                        Total coloreados: <span id="rep-count-centesimas">0</span>
                    </div>
                </div>
            </div>
            <div class="modal" id="rep-modal-milesimas">
                <div class="close-btn" onclick="rep_closeModal('milesimas')">‚úï</div>
                <div class="modal-content">
                    <h2 class="modal-title">MIL√âSIMAS</h2>
                    <div class="modal-square">
                        <div class="grid grid-1000" id="rep-modal-grid-milesimas"></div>
                    </div>
                    <div class="modal-info">
                        Cada cuadrito ‚âà 1 mil√©sima (0.001).<br>
                        Total coloreados: <span id="rep-count-milesimas">0</span>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        // === SCRIPT DE NAVEGACI√ìN GLOBAL ===
        function showApp(appId) {
            // Ocultar todas las vistas
            document.querySelectorAll('.app-view').forEach(view => {
                view.classList.remove('active');
            });
            // Quitar 'active' de todos los botones
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Mostrar la vista seleccionada
            document.getElementById(appId).classList.add('active');
            // Marcar el bot√≥n como activo
            document.getElementById('nav-btn-' + appId.split('-')[1]).classList.add('active');
        }
        
        // === SCRIPT PARA LA HERRAMIENTA DE COMPARACI√ìN ===
        document.getElementById('recta-toggle-comparison').addEventListener('click', function() {
            const container = document.getElementById('recta-comparison-container');
            container.classList.toggle('hidden');
            
            // Si se muestra el comparador, inicializar la recta est√°tica
            if (!container.classList.contains('hidden')) {
                drawCompStaticNumberLineTicks();
            }
        });
        
        document.getElementById('comp-compareBtn').addEventListener('click', runComparison);
        
        // Permitir presionar "Enter" en los inputs
        document.getElementById('comp-num1').addEventListener('keypress', e => e.key === 'Enter' && runComparison());
        document.getElementById('comp-num2').addEventListener('keypress', e => e.key === 'Enter' && runComparison());
        document.getElementById('comp-num3').addEventListener('keypress', e => e.key === 'Enter' && runComparison());
        
        /**
         * Funci√≥n principal que se ejecuta al hacer clic en "Comparar"
         */
        function runComparison() {
            const errorDiv = document.getElementById('comp-errorMessage');
            const comparisonSection = document.getElementById('comp-comparison-section');
            const resultDiv = document.getElementById('comp-comparison-result');
            const dynamicLineDiv = document.getElementById('comp-mainNumberLine');
            const staticLineDiv = document.getElementById('comp-staticNumberLine');
            
            errorDiv.textContent = '';
            dynamicLineDiv.innerHTML = '<div class="line-comparison"></div>'; // Limpiar recta din√°mica
            comparisonSection.classList.add('hidden');
            resultDiv.classList.add('hidden');
            
            // Limpiar marcadores ANTERIORES de la recta est√°tica
            staticLineDiv.querySelectorAll('.marker-comparison, .marker-label-comparison').forEach(el => el.remove());
            
            // 1. Obtener y parsear los n√∫meros
            const inputs = [
                document.getElementById('comp-num1').value,
                document.getElementById('comp-num2').value,
                document.getElementById('comp-num3').value
            ];
            
            const numbers = [];
            for (let i = 0; i < inputs.length; i++) {
                if (inputs[i].trim() !== '') {
                    const num = parseDecimal(inputs[i]);
                    if (isNaN(num)) {
                        errorDiv.textContent = `‚ö† Valor inv√°lido en 'N√∫mero ${i+1}'. Usa formatos como 1.5 o -0,2.`;
                        return;
                    }
                    numbers.push({ value: num, id: i + 1 });
                }
            }
            
            if (numbers.length === 0) {
                errorDiv.textContent = '‚ö†Ô∏è Introduce al menos un n√∫mero para comparar.';
                return;
            }
            
            // 2. Dibujar en la recta est√°tica (SOLO los n√∫meros entre 1 y 10)
            const staticNumbers = numbers.filter(n => n.value >= 1 && n.value <= 10);
            drawAllMarkers(staticLineDiv, staticNumbers, 1, 10);
            
            // 3. Ordenar los n√∫meros para la recta din√°mica y el resultado
            numbers.sort((a, b) => a.value - b.value);
            
            // 4. Determinar el rango de la recta din√°mica
            const minNum = numbers[0].value;
            const maxNum = numbers[numbers.length - 1].value;
            
            let lineMin = Math.floor(minNum);
            let lineMax = Math.ceil(maxNum);
            
            if (lineMin === lineMax) {
                lineMin -= 1;
                lineMax += 1;
            }
            
            if (minNum - lineMin < 0.2) lineMin -= 1;
            if (lineMax - maxNum < 0.2) lineMax += 1;
            
            // 5. Dibujar la recta num√©rica din√°mica (marcas de unidades)
            drawNumberLineTicks(dynamicLineDiv, lineMin, lineMax);
            
            // 6. Dibujar los marcadores para cada n√∫mero en la recta din√°mica
            drawAllMarkers(dynamicLineDiv, numbers, lineMin, lineMax);
            
            // 7. Mostrar el resultado ordenado
            const resultString = numbers.map(n => formatToLocale(n.value)).join(' < ');
            resultDiv.innerHTML = `Orden: ${resultString}`;
            
            // Mostrar las secciones
            comparisonSection.classList.remove('hidden');
            resultDiv.classList.remove('hidden');
        }
        
        /**
         * Dibuja todos los marcadores en una recta con anti-solapamiento.
         * @param {HTMLElement} container - El div de la recta
         * @param {Array} numbers - Array de objetos {value, id}
         * @param {number} min - Valor m√≠nimo de la recta
         * @param {number} max - Valor m√°ximo de la recta
         */
        function drawAllMarkers(container, numbers, min, max) {
            // Ordenar por valor para asignar niveles de izq a dcha
            const sortedNumbers = [...numbers].sort((a, b) => a.value - b.value);
            
            // Niveles verticales (en px) para evitar solapamiento
            const levels = [-30, -55, -80]; 
            const range = max - min;
            
            if (range === 0) return; // Evitar divisi√≥n por cero
            
            sortedNumbers.forEach((numData, index) => {
                const { value, id } = numData;
                
                // Nivel vertical escalonado
                const levelTop = levels[index % levels.length];
                
                const percent = ((value - min) / range) * 100;
                const position = 5 + (percent * 0.90); // Posici√≥n ajustada al margen 5%-95%
                
                // No dibujar si est√° fuera de la l√≠nea visible
                if (position < 5 || position > 95) {
                    return;
                }
                
                // Marcador (l√≠nea vertical)
                const marker = document.createElement('div');
                marker.className = `marker-comparison marker-${id}`;
                marker.style.left = `${position}%`;
                
                // Etiqueta (globo con el n√∫mero)
                const label = document.createElement('div');
                label.className = `marker-label-comparison label-${id}`;
                label.textContent = formatToLocale(value);
                label.style.left = `${position}%`;
                label.style.top = `${levelTop}px`; // Asignar altura din√°mica
                
                container.appendChild(marker);
                container.appendChild(label);
            });
        }
        
        /**
         * Dibuja la l√≠nea y las marcas de las unidades (Ticks)
         * @param {HTMLElement} container - El div de la recta
         * @param {number} min - Valor m√≠nimo de la recta
         * @param {number} max - Valor m√°ximo de la recta
         */
        function drawNumberLineTicks(container, min, max) {
            const range = max - min;
            const numTicks = Math.round(range);
            
            let step = 1;
            if (numTicks > 20) {
                step = Math.ceil(numTicks / 20);
            }
            
            for (let i = min; i <= max; i += step) {
                const value = Math.round(i);
                if (value < min || value > max) continue;
                
                const percent = ((value - min) / range) * 100;
                const position = 5 + (percent * 0.90); 
                
                if (position >= 5 && position <= 95) {
                    const tick = document.createElement('div');
                    tick.className = 'tick-comparison';
                    tick.style.left = `${position}%`;
                    
                    const label = document.createElement('div');
                    label.className = 'tick-label-comparison';
                    label.textContent = formatToLocale(value);
                    label.style.left = `${position}%`;
                    
                    container.appendChild(tick);
                    container.appendChild(label);
                }
            }
        }
        
        /**
         * Dibuja las marcas de la recta num√©rica est√°tica (solo los ticks del 1 al 10)
         */
        function drawCompStaticNumberLineTicks() {
            const container = document.getElementById('comp-staticNumberLine');
            if (!container) return;
            
            container.innerHTML = '<div class="line-comparison"></div>';
            
            const min = 1;
            const max = 10;
            const range = max - min; // Rango es 9
            
            for (let i = min; i <= max; i++) {
                const value = i;
                const percent = ((value - min) / range) * 100;
                const position = 5 + (percent * 0.90); 
                
                const tick = document.createElement('div');
                tick.className = 'tick-comparison';
                tick.style.left = `${position}%`;
                
                const label = document.createElement('div');
                label.className = 'tick-label-comparison';
                label.textContent = value;
                label.style.left = `${position}%`;
                
                container.appendChild(tick);
                container.appendChild(label);
            }
        }
        
        /**
         * Convierte una entrada de texto (con . o ,) en un n√∫mero
         */
        function parseDecimal(input) {
            let clean = input.trim().replace(/,/g, '.');
            return parseFloat(clean);
        }
        
        /**
         * Formatea un n√∫mero para mostrarlo (con coma decimal)
         */
        function formatToLocale(num) {
            return num.toLocaleString('es-ES', { 
                minimumFractionDigits: 0, 
                maximumFractionDigits: 4 
            });
        }
        
        // === SCRIPT PARA APP 1: RECTA NUM√âRICA ===
        // Se usa una IIFE (Funci√≥n autoejecutable) para aislar el scope
        // y evitar colisiones de nombres de funciones como 'parseDecimal'.
        (function() {
            // Se usan los IDs prefijados: 'recta-locateBtn', 'recta-decimalInput', etc.
            document.getElementById('recta-locateBtn').addEventListener('click', locateDecimal);
            document.getElementById('recta-decimalInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') locateDecimal();
            });
            function parseDecimal(input) {
                let clean = input.trim().replace(/,/g, '.');
                return parseFloat(clean);
            }
            function formatToLocale(num) {
                return num.toLocaleString('es-ES', { minimumFractionDigits: 0, maximumFractionDigits: 3 });
            }
            function locateDecimal() {
                const input = document.getElementById('recta-decimalInput').value;
                const errorDiv = document.getElementById('recta-errorMessage');
                errorDiv.textContent = '';
                if (!input) {
                    errorDiv.textContent = '‚ö†Ô∏è Introduce un n√∫mero decimal.';
                    return;
                }
                const num = parseDecimal(input);
                if (isNaN(num)) {
                    errorDiv.textContent = '‚ùå Formato inv√°lido. Usa n√∫meros como 1.376 o 2,5.';
                    return;
                }
                if (Math.abs(num) > 1000) {
                    errorDiv.textContent = 'üìè Usa un n√∫mero entre -1000 y 1000.';
                    return;
                }
                document.getElementById('recta-section2').classList.remove('hidden');
                document.getElementById('recta-section3').classList.remove('hidden');
                document.getElementById('recta-section4').classList.remove('hidden');
                drawUnitsLine(num);
                drawTenthsLine(num);
                drawHundredthsLine(num);
                drawThousandthsLine(num);
            }
            // === UNIDADES ===
            function drawUnitsLine(num) {
                const container = document.getElementById('recta-lineUnits');
                container.innerHTML = '<div class="line"></div>';
                const start = Math.floor(num / 10) * 10;
                const end = start + 10;
                for (let i = 0; i <= 10; i++) {
                    const value = start + i;
                    const percent = 5 + (i / 10) * 90;
                    const tick = document.createElement('div');
                    tick.className = 'tick';
                    tick.style.left = `${percent}%`;
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.textContent = value.toLocaleString('es-ES');
                    tick.appendChild(label);
                    container.appendChild(tick);
                }
                const pos = ((num - start) / (end - start)) * 90;
                const markerPercent = 5 + pos;
                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.style.left = `${markerPercent}%`;
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = formatToLocale(num);
                marker.appendChild(label);
                container.appendChild(marker);
            }
            // === D√âCIMAS ===
            function drawTenthsLine(num) {
                const container = document.getElementById('recta-lineTenths');
                container.innerHTML = '<div class="line"></div>';
                const start = Math.floor(num);
                for (let i = 0; i <= 10; i++) {
                    const value = start + i * 0.1;
                    const percent = 5 + (i / 10) * 90;
                    const tick = document.createElement('div');
                    tick.className = 'tick';
                    tick.style.left = `${percent}%`;
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.textContent = value.toLocaleString('es-ES', {minimumFractionDigits: 1, maximumFractionDigits: 1});
                    tick.appendChild(label);
                    container.appendChild(tick);
                }
                const pos = (num - start) * 10 * 9;
                const markerPercent = 5 + pos;
                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.style.left = `${markerPercent}%`;
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = formatToLocale(num);
                marker.appendChild(label);
                container.appendChild(marker);
            }
            // === CENT√âSIMAS ===
            function drawHundredthsLine(num) {
                const container = document.getElementById('recta-lineHundredths');
                container.innerHTML = '<div class="line"></div>';
                const start = Math.floor(num * 10) / 10;
                for (let i = 0; i <= 10; i++) {
                    const value = start + i * 0.01;
                    const percent = 5 + (i / 10) * 90;
                    const tick = document.createElement('div');
                    tick.className = 'tick';
                    tick.style.left = `${percent}%`;
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.textContent = value.toLocaleString('es-ES', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                    tick.appendChild(label);
                    container.appendChild(tick);
                }
                const pos = ((num - start) / 0.1) * 90;
                const markerPercent = 5 + pos;
                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.style.left = `${markerPercent}%`;
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = formatToLocale(num);
                marker.appendChild(label);
                container.appendChild(marker);
            }
            // === MIL√âSIMAS ===
            function drawThousandthsLine(num) {
                const container = document.getElementById('recta-lineThousandths');
                container.innerHTML = '<div class="line"></div>';
                const start = Math.floor(num * 100) / 100;
                for (let i = 0; i <= 10; i++) {
                    const value = start + i * 0.001;
                    const percent = 5 + (i / 10) * 90;
                    const tick = document.createElement('div');
                    tick.className = 'tick';
                    tick.style.left = `${percent}%`;
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.textContent = value.toLocaleString('es-ES', {minimumFractionDigits: 3, maximumFractionDigits: 3});
                    tick.appendChild(label);
                    container.appendChild(tick);
                }
                const pos = ((num - start) / 0.01) * 90;
                const markerPercent = 5 + pos;
                const marker = document.createElement('div');
                marker.className = 'marker';
                marker.style.left = `${markerPercent}%`;
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = formatToLocale(num);
                marker.appendChild(label);
                container.appendChild(marker);
            }
        })();
        
        // === SCRIPT PARA APP 2: CONCEPTOS (CUADROS) ===
        // Funciones prefijadas con 'con_' para evitar colisiones
        // Estas deben ser globales porque son llamadas por 'onclick'
        function con_generateGrid(elementId, cells) {
            const grid = document.getElementById(elementId);
            for (let i = 0; i < cells; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                grid.appendChild(cell);
            }
        }
        function con_openModal(type) {
            const modal = document.getElementById('con-modal-' + type);
            modal.classList.add('active');
            // document.body.style.overflow = 'hidden'; // Se maneja a nivel global
        }
        function con_closeModal(type) {
            const modal = document.getElementById('con-modal-' + type);
            modal.classList.remove('active');
            // document.body.style.overflow = 'auto'; // Se maneja a nivel global
        }
        // Generar cuadr√≠culas de vista previa para App 2 (IDs prefijados)
        con_generateGrid('con-preview-decimas', 10);
        con_generateGrid('con-preview-centesimas', 100);
        con_generateGrid('con-preview-milesimas', 1024);
        con_generateGrid('con-modal-grid-decimas', 10);
        con_generateGrid('con-modal-grid-centesimas', 100);
        con_generateGrid('con-modal-grid-milesimas', 1024);
        // Listeners para cerrar modales de App 2 (aislados)
        (function() {
            document.querySelectorAll('#app-conceptos .modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('#app-conceptos .modal').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        })();
        
        // === SCRIPT PARA APP 3: REPRESENTACI√ìN DIN√ÅMICA ===
        // Funciones prefijadas con 'rep_' para evitar colisiones
        // Estas deben ser globales porque son llamadas por 'onclick'
        function rep_clearContainer(id) {
            document.getElementById(id).innerHTML = '';
        }
        function rep_createUnitCard(isFilled, index) {
            const div = document.createElement('div');
            div.className = 'square ' + (isFilled ? 'filled' : '');
            div.title = isFilled ? 'Unidad completa' : 'Unidad vac√≠a';
            return div;
        }
        function rep_createGrid(containerId, totalCells, filledCells, cellClass = 'grid-cell') {
            const container = document.getElementById(containerId);
            rep_clearContainer(containerId); // Usa la funci√≥n prefijada
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.className = cellClass;
                if (i < filledCells) {
                    cell.classList.add('filled');
                }
                container.appendChild(cell);
            }
        }
        function rep_clearRepresentation() {
            rep_renderDefaultState(); // Usa la funci√≥n prefijada
            document.getElementById('rep-decimalInput').value = '';
            document.getElementById('rep-errorMessage').textContent = '';
        }
        function rep_renderDefaultState() {
            const container = document.getElementById('rep-representationContainer');
            container.innerHTML = ''; 
            const cardUnit = document.createElement('div');
            cardUnit.className = 'card';
            cardUnit.innerHTML = `
                <h2 class="card-title">UNIDADES</h2>
                <div class="square-container">
                    <div class="square empty-unit"></div> 
                </div>
                <div class="formula">
                    <span class="highlight">0 unidades</span>
                </div>
            `;
            cardUnit.onclick = () => rep_openUnitsModal(0); // Usa la funci√≥n prefijada
            container.appendChild(cardUnit);
            const cardDecimas = document.createElement('div');
            cardDecimas.className = 'card';
            cardDecimas.innerHTML = `
                <h2 class="card-title">D√âCIMAS</h2>
                <div class="square-container">
                    <div class="grid grid-10" id="rep-preview-decimas"></div>
                </div>
                <div class="formula">
                    0 d√©cimas = <span class="fraction"><span class="fraction-top">0</span><span class="fraction-bottom">10</span></span> = 0
                </div>
            `;
            cardDecimas.onclick = () => rep_openModal('decimas', 0, 10); // Usa la funci√≥n prefijada
            container.appendChild(cardDecimas);
            rep_createGrid('rep-preview-decimas', 10, 0); // Usa la funci√≥n prefijada
            const cardCentesimas = document.createElement('div');
            cardCentesimas.className = 'card';
            cardCentesimas.innerHTML = `
                <h2 class="card-title">CENT√âSIMAS</h2>
                <div class="square-container">
                    <div class="grid grid-100" id="rep-preview-centesimas"></div>
                </div>
                <div class="formula">
                    0 cent√©simas = <span class="fraction"><span class="fraction-top">0</span><span class="fraction-bottom">100</span></span> = 0
                </div>
            `;
            cardCentesimas.onclick = () => rep_openModal('centesimas', 0, 100); // Usa la funci√≥n prefijada
            container.appendChild(cardCentesimas);
            rep_createGrid('rep-preview-centesimas', 100, 0); // Usa la funci√≥n prefijada
            const cardMilesimas = document.createElement('div');
            cardMilesimas.className = 'card';
            cardMilesimas.innerHTML = `
                <h2 class="card-title">MIL√âSIMAS</h2>
                <div class="square-container">
                    <div class="grid grid-1000" id="rep-preview-milesimas"></div>
                </div>
                <div class="formula">
                    0 mil√©simas = <span class="fraction"><span class="fraction-top">0</span><span class="fraction-bottom">1000</span></span> = 0
                </div>
            `;
            cardMilesimas.onclick = () => rep_openModal('milesimas', 0, 1000); // Usa la funci√≥n prefijada
            container.appendChild(cardMilesimas);
            rep_createGrid('rep-preview-milesimas', 1024, 0); // Usa la funci√≥n prefijada
        }
        function rep_renderDecimal() {
            const input = document.getElementById('rep-decimalInput').value;
            const errorDiv = document.getElementById('rep-errorMessage');
            errorDiv.textContent = '';
            if (input === '') {
                errorDiv.textContent = 'Por favor, introduce un n√∫mero.';
                return;
            }
            let num = parseFloat(input);
            if (isNaN(num) || num < 0) {
                errorDiv.textContent = 'Introduce un n√∫mero decimal v√°lido ‚â• 0.';
                return;
            }
            num = Math.round(num * 1000) / 1000;
            const whole = Math.floor(num);
            const totalMilesimas = Math.round((num - whole) * 1000);
            const decimas = Math.floor(totalMilesimas / 100);
            const centesimas = Math.floor((totalMilesimas % 100) / 10);
            const milesimas = totalMilesimas % 10;
            const container = document.getElementById('rep-representationContainer');
            container.innerHTML = '';
            if (whole > 0) {
                for (let i = 0; i < whole; i++) {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <h2 class="card-title">UNIDAD</h2>
                        <div class="square-container">
                            <div class="square filled"></div>
                        </div>
                        <div class="formula">
                            <span class="highlight">1 unidad</span> = 1 entero
                        </div>
                    `;
                    container.appendChild(card);
                }
            } else {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h2 class="card-title">UNIDADES</h2>
                    <div class="square-container">
                        <div class="square empty-unit"></div> 
                    </div>
                    <div class="formula">
                        <span class="highlight">0 unidades</span>
                    </div>
                `;
                card.onclick = () => rep_openUnitsModal(0); // Usa la funci√≥n prefijada
                container.appendChild(card);
            }
            if (decimas > 0 || centesimas > 0 || milesimas > 0) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h2 class="card-title">D√âCIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-10" id="rep-preview-decimas"></div>
                    </div>
                    <div class="formula">
                        ${decimas} d√©cimas = <span class="fraction"><span class="fraction-top">${decimas}</span><span class="fraction-bottom">10</span></span> = ${decimas / 10} 
                    </div>
                `;
                card.onclick = () => rep_openModal('decimas', decimas, 10); // Usa la funci√≥n prefijada
                container.appendChild(card);
                rep_createGrid('rep-preview-decimas', 10, decimas); // Usa la funci√≥n prefijada
            }
            if (centesimas > 0 || milesimas > 0) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h2 class="card-title">CENT√âSIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-100" id="rep-preview-centesimas"></div>
                    </div>
                    <div class="formula">
                        ${centesimas} cent√©simas = <span class="fraction"><span class="fraction-top">${centesimas}</span><span class="fraction-bottom">100</span></span> = ${centesimas / 100}
                    </div>
                `;
                card.onclick = () => rep_openModal('centesimas', centesimas, 100); // Usa la funci√≥n prefijada
                container.appendChild(card);
                rep_createGrid('rep-preview-centesimas', 100, centesimas); // Usa la funci√≥n prefijada
            }
            if (milesimas > 0) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h2 class="card-title">MIL√âSIMAS</h2>
                    <div class="square-container">
                        <div class="grid grid-1000" id="rep-preview-milesimas"></div>
                    </div>
                    <div class="formula">
                        ${milesimas} mil√©simas = <span class="fraction"><span class="fraction-top">${milesimas}</span><span class="fraction-bottom">1000</span></span> = ${milesimas / 1000}
                    </div>
                `;
                card.onclick = () => rep_openModal('milesimas', milesimas, 1000); // Usa la funci√≥n prefijada
                container.appendChild(card);
                const approxCells = Math.round((milesimas / 1000) * 1024);
                rep_createGrid('rep-preview-milesimas', 1024, approxCells); // Usa la funci√≥n prefijada
            }
            if (whole === 0 && decimas === 0 && centesimas === 0 && milesimas === 0) {
                container.innerHTML = '<p style="color:white; font-size:20px;">El n√∫mero 0 no tiene partes para representar.</p>';
            }
        }
        function rep_openUnitsModal(count) {
            const modal = document.getElementById('rep-modal-unidad');
            const squareDiv = document.getElementById('rep-modal-square-unidad');
            const infoDiv = document.getElementById('rep-modal-info-unidad');
            squareDiv.innerHTML = ''; 
            if (count === 0) {
                squareDiv.innerHTML = '<div class="square empty-unit" style="width: 100%; height: 100%; background: #fff;"></div>';
                infoDiv.innerHTML = `Se muestran <span class="highlight">0 unidades</span>.`;
            } else {
                let squareSize;
                if (count === 1) { squareSize = 200; } 
                else {
                    const maxUnitsPerRow = Math.ceil(Math.sqrt(count));
                    squareSize = Math.min(200, 250 / maxUnitsPerRow * 3);
                }
                for (let i = 0; i < count; i++) {
                    const unit = document.createElement('div');
                    unit.className = 'modal-unit';
                    unit.style.width = squareSize + 'px';
                    unit.style.height = squareSize + 'px';
                    squareDiv.appendChild(unit);
                }
                infoDiv.innerHTML = `Se muestran <span class="highlight">${count} unidades</span> completas.`;
            }
            modal.classList.add('active');
        }
        function rep_openModal(type, filled, total) {
            let modalId, gridId, countId, title;
            if (type === 'decimas') {
                modalId = 'rep-modal-decimas';
                gridId = 'rep-modal-grid-decimas';
                countId = 'rep-count-decimas';
                rep_createGrid(gridId, 10, filled); // Usa la funci√≥n prefijada
                document.getElementById(countId).textContent = filled;
            } else if (type === 'centesimas') {
                modalId = 'rep-modal-centesimas';
                gridId = 'rep-modal-grid-centesimas';
                countId = 'rep-count-centesimas';
                rep_createGrid(gridId, 100, filled); // Usa la funci√≥n prefijada
                document.getElementById(countId).textContent = filled;
            } else if (type === 'milesimas') {
                modalId = 'rep-modal-milesimas';
                gridId = 'rep-modal-grid-milesimas';
                countId = 'rep-count-milesimas';
                const approx = Math.round((filled / 1000) * 1024);
                rep_createGrid(gridId, 1024, approx); // Usa la funci√≥n prefijada
                document.getElementById(countId).textContent = filled;
            }
            document.getElementById(modalId).classList.add('active');
        }
        function rep_closeModal(type) {
            const modal = document.getElementById('rep-modal-' + type);
            modal.classList.remove('active');
        }
        // Listeners para cerrar modales de App 3 (aislados)
        (function() {
            document.querySelectorAll('#app-representacion .modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('#app-representacion .modal').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        })();
        // Inicializar el estado por defecto de la App 3
        rep_renderDefaultState();
    </script>
</body>
</html>
